# Sage Stocks

*Last updated: December 6, 2025*

**Invest with calm confidence, powered by intelligence that never hallucinates.**

Sage Stocks delivers professional-grade stock analysis through **Sage Intelligence** â€” our proprietary knowledge layer that combines deterministic financial calculations with proven investment frameworks. Zero guesswork. Zero hallucinations. Just clear, context-aware insights that help you make better decisions.

**Version:** v0.1.0 (User) / v1.4.0 (Dev)

**Status:** Production-ready with Sage Intelligence engine, Sage Counsel decision journal, market context integration, and event-aware analysis

**Author:** Shalom Ormsby

---

## What Makes Sage Stocks Different

### Powered by Sage Intelligence

At the core of Sage Stocks is **Sage Intelligence** â€” a two-layer architecture that delivers 0% hallucination risk:

1. **The math layer:** Deterministic calculations based on professional-grade financial metrics. No estimates. No guesses.
2. **The interpretation layer:** AI analysis that applies proven investment frameworks (Buffett, Dalio, Lynch) systematically and unemotionally.

**Design Philosophy:** *Simple. Smart. Approachable.* Built for daily stock analyses, not enterprise scale. Clean architecture, production-grade code, minimal complexity.

### What Sage Stocks Does for You

- **Complete stock analysis in under 60 seconds** using real-time market data (FMP + FRED APIs)
- **Sage Intelligence engine** - Multi-dimensional scoring across 6 dimensions + market alignment (1.0-5.0 scale)
- **Sage Counsel decision journal** - Document every investment decision with full context, reasoning, and outcome tracking
- **Market context integration** - Analyzes market regime (Risk-On/Risk-Off/Transition) before individual stock analysis
- **Delta-first analysis** - Shows what changed since last analysis, with 90-day historical tracking
- **Event-aware intelligence** - Tracks earnings calls, dividends, splits, and guidance for portfolio stocks
- **AI-generated narratives** with regime-aware analysis and historical context
- **Syncs to Notion databases** for analysis storage and review â†’ PostgreSQL migration planned (v2.0)
- **Multi-tenant architecture** with per-user database isolation and OAuth authentication
- **Rate limits with bypass system** (10 analyses/user/day, intelligent override codes)

---

## Core Features

### ğŸ§  Sage Intelligence: Multi-Dimensional Analysis

Sage Intelligence evaluates every stock across **six critical dimensions**:

| Category | Weight | What It Measures |
| --- | --- | --- |
| **Technical** | 28.5% | RSI, MACD, Bollinger Bands, SMA crossovers, volume trends |
| **Fundamental** | 33% | P/E ratio, EPS growth, revenue growth, profit margins, ROE |
| **Macro** | 19% | Market regime, sector rotation, yield curve, VIX, unemployment |
| **Risk** | 14.5% | Beta, volatility, drawdown, correlation to market |
| **Market Alignment** | 5% | Regime fit (beta vs Risk-On/Off), sector leadership, VIX context |
| **Sentiment** | 0% | Calculated score (1.0-5.0) displayed for reference, not included in composite |

**Composite Score (1.0-5.0)** combines all dimensions into a single actionable signal:

- **Strong Buy (4.0-5.0)** - Compelling opportunity across multiple factors
- **Buy (3.5-3.9)** - Attractive risk/reward, favorable conditions
- **Moderate Buy (3.0-3.4)** - Positive outlook, above-neutral signals
- **Hold (2.5-2.9)** - Neutral outlook, watch and wait
- **Moderate Sell (2.0-2.4)** - Below-neutral signals, consider caution
- **Sell (1.5-1.9)** - Deteriorating conditions, consider reducing
- **Strong Sell (1.0-1.4)** - Significant concerns, exit recommended

### ğŸ“Š Sage Counsel: Your Investment Decision Journal

**New in v1.4+**: Document every investment decision with full context and reasoning. Sage Counsel transforms scattered investment thoughts into a **systematic decision-making system** that makes you smarter over time.

**What Gets Tracked:**

- **Decision** - What you decided and why
- **Entry/Exit Prices** - Your target prices for getting in and out
- **Catalyst** - What would change your mind
- **Article Source** - The research or news that informed your decision
- **Outcome Tracking** - Mark whether you were Correct, Incorrect, or Partial later

**Why This Matters:**

- **Build discipline** - When you document reasoning, you're less likely to act on emotion or FOMO
- **Learn from outcomes** - Review after 6 months: Did your strategy work? Were your catalysts accurate?
- **Accountability** - Future you can see what past you was thinking
- **Decision quality > outcome** - A good decision with bad luck is still a good decision

**Example Entry:**

> **ORCL: Wait for $205 entry despite Wells Fargo $280 target**
>
> Despite bullish $280 price target citing $500B AI deals, waiting for $200-$205 entry. Technical setup unchanged (weak volume, Tech sector lagging #10/11). Bull case is long-term (2029)â€”no rush to chase headlines.
>
> **Catalyst**: Add if Tech sector returns to top 5 + volume exceeds 20% average.

Legendary investors like Buffett and Dalio document every major decision. **Sage Counsel brings this institutional practice to individual investors**â€”built right into your workspace.

### ğŸŒ Market Context Intelligence

Before analyzing individual stocks, Sage Intelligence reads the market environment:

**Daily Market Regime Detection:**

- **ğŸŸ¢ Risk-On** - Markets trending up, VIX below 20, growth sectors leading
- **ğŸ”´ Risk-Off** - Markets trending down, VIX above 25, defensive sectors leading
- **ğŸŸ¡ Transition** - Mixed signals, VIX 20-25, unclear direction

**Sector Rotation Tracking:** See which of 11 major sectors are winning or losing in real-time.

**Economic Indicators Dashboard:** VIX, Fed Funds Rate, Unemployment, Yield Curve (all auto-updated).

**Why this matters:** The same stock can be a great buy in Risk-On and a dangerous hold in Risk-Off. Context changes everything.

### ğŸ“… Event-Aware Intelligence

Sage Intelligence automatically tracks upcoming catalysts for all your portfolio and watchlist stocks:

- **ğŸ“Š Earnings Calls** - Know exactly when companies report quarterly results
- **ğŸ’µ Dividend Dates** - Track ex-dividend dates and payment schedules
- **ğŸ”€ Stock Splits** - Get notified of upcoming split events
- **ğŸ¯ Guidance Updates** - See when management commentary is expected

Events are automatically included in AI-generated analysis with urgency indicators:

- **ğŸ”¥ Imminent (within 7 days)** - High volatility risk, AI notes timing considerations
- **âš ï¸ Approaching (within 14 days)** - Medium urgency, factors catalyst timing
- **ğŸ“… Distant (15-30 days)** - Lower urgency, assesses positioning window

### ğŸ“ˆ Historical Tracking & Delta-First Analysis

Sage Intelligence doesn't just give snapshotsâ€”it **tracks how things change over time**:

- **Score changes** - Is the composite score improving or deteriorating?
- **Price changes** - How much has the stock moved since last analysis?
- **Trend direction** - Are fundamentals strengthening or weakening?
- **Recommendation changes** - Has our outlook shifted?

Every analysis is automatically archived in your **Stock History database** with timestamps, creating a growing research library. After 90 days, you'll have enough data to spot patterns. After a year, your dataset becomes irreplaceable.

### ğŸ¤– AI-Generated Analysis

Sage Intelligence generates 7-section narratives using Google Gemini Flash 2.5:

1. **Executive Summary** - Buy/Hold/Sell recommendation with confidence level
2. **Technical Analysis** - Chart patterns, momentum indicators, support/resistance
3. **Fundamental Analysis** - Valuation metrics, earnings quality, growth prospects
4. **Risk Assessment** - Downside risks, volatility analysis, worst-case scenarios
5. **Macro Context** - Economic headwinds/tailwinds, sector trends, market regime
6. **Historical Trends** - Score deltas vs. previous analyses, trend direction
7. **Action Items** - Specific recommendations (e.g., "Wait for RSI < 30 before entry")

**Token Optimization:** 67% reduction in tokens (6,000 â†’ 2,000), 50% reduction in latency.

---

## Architecture

### Technology Stack

**Backend:**

- **Platform:** Vercel Serverless Functions (300s timeout, Node.js 18+)
- **Language:** TypeScript 5.3+ (~14,800 LOC)
- **Runtime:** Node.js serverless environment

**Data Sources:**

- **Financial Modeling Prep (FMP)** - Stock data, fundamentals, technical indicators ($22-29/month)
- **FRED API** - Macroeconomic data (yield curve, VIX, unemployment) (free)
- **Upstash Redis** - Distributed rate limiting state (REST API, serverless-native)

**LLM Integration (Sage Intelligence):**

- **Provider-agnostic abstraction layer** supporting:
    - Google Gemini (Flash 2.5, Flash 1.5) - Primary, $0.013/analysis
    - OpenAI (GPT-4 Turbo, GPT-3.5 Turbo)
    - Anthropic (Claude 3.5 Sonnet, Claude 3 Haiku)
- **Configurable via environment variable** (`LLM_PROVIDER`)
- **67% token reduction** vs. original prompts

**Integration:**

- **Notion API** - Database operations (v1.4.0, transitioning to PostgreSQL in v2.0)
- **REST APIs** - All external communication via HTTP

### API Endpoints

| Endpoint | Method | Description | Timeout |
| --- | --- | --- | --- |
| `/api/health` | GET | Health check (uptime, version) | 10s |
| `/api/analyze` | POST | Stock analysis (full Sage Intelligence workflow) | 300s |
| `/api/webhook` | POST | Notion webhook handler | 60s |
| `/api/bypass` | GET/POST | Activate bypass code session | 10s |
| `/api/usage` | GET | Check rate limit usage | 10s |
| `/api/api-status` | GET | API monitoring dashboard | 30s |

### Data Flow (v1.4.0)

```
User (Web Interface)
    â†“ POST /api/analyze {ticker, userId}
Vercel Serverless Function
    â†“ Check rate limit (Redis)
    â†“ [Step 0] Fetch market context (cached, <100ms or 3-5s if cache miss)
        â€¢ Market regime classification (Risk-On/Risk-Off/Transition)
        â€¢ Sector rotation analysis (11 sector ETFs)
        â€¢ Economic indicators (VIX, Fed Funds, Unemployment, Yield Curve)
    â†“ Fetch stock data (FMP + FRED, 3-5s)
    â†“ Calculate scores including market alignment (1s)
    â†“ Query 90-day historical analyses (Notion, 2-5s)
    â†“ Compute deltas with regime context (<1s)
    â†“ Generate delta-first LLM analysis (Gemini, 10-20s)
    â†“ Write to Notion (3 operations, 10-15s)
        â€¢ Update Stock Analyses page (metrics + market regime)
        â€¢ Create child analysis page (AI content)
        â€¢ Archive to Stock History (with market regime)
    â†“ Return {pageUrl, scores, metadata}
User
    â†’ Opens Notion analysis page
```

**Total Latency:** 30-45 seconds (under 300s Vercel Pro timeout)

---

## Key Features

### Multi-Dimensional Analysis

Composite score (1.0-5.0) calculated from weighted categories:

| Category | Weight | Metrics Included |
| --- | --- | --- |
| **Technical** | 28.5% | RSI, MACD, Bollinger Bands, SMA crossovers, volume trends |
| **Fundamental** | 33% | P/E ratio, EPS growth, revenue growth, profit margins, ROE |
| **Macro** | 19% | Market regime, sector rotation, yield curve, VIX, unemployment |
| **Risk** | 14.5% | Beta, volatility, drawdown, correlation to market |
| **Market Alignment** | 5% | Regime fit (beta vs Risk-On/Off), sector leadership, VIX context |
| **Sentiment** | 0% | Calculated score (1.0-5.0) displayed for reference, not included in composite |
| **Sector** | - | Relative sector performance vs. S&P 500 |

**Recommendations:**

- Strong Buy (4.0+)
- Buy (3.5-3.99)
- Moderate Buy (3.0-3.49)
- Hold (2.5-2.99)
- Moderate Sell (2.0-2.49)
- Sell (1.5-1.99)
- Strong Sell (<1.5)

### AI-Generated Analysis

7-section narrative generated by Google Gemini Flash 2.5:

1. **Executive Summary** - Buy/Hold/Sell recommendation with confidence level
2. **Technical Analysis** - Chart patterns, momentum indicators, support/resistance
3. **Fundamental Analysis** - Valuation metrics, earnings quality, growth prospects
4. **Risk Assessment** - Downside risks, volatility analysis, worst-case scenarios
5. **Macro Context** - Economic headwinds/tailwinds, sector trends, market regime
6. **Historical Trends** - Score deltas vs. previous analyses, trend direction
7. **Action Items** - Specific recommendations (e.g., "Wait for RSI < 30 before entry")

**Token Optimization:**

- Original prompts: 6,000 tokens â†’ 30s generation time
- Optimized prompts: 2,000 tokens â†’ 10-15s generation time
- **67% reduction** in tokens, **50% reduction** in latency

### Rate Limiting & Access Control

**User-level quotas:**

- 10 analyses per user per day (resets at midnight UTC)
- Tracked in Upstash Redis (distributed state)
- Graceful degradation (fails open if Redis unavailable)

**Bypass code system:**

- Session-based bypass (one-time code entry)
- Unlimited analyses until midnight UTC
- Stored in Redis with TTL expiry
- Admin bypass via environment variable

**Endpoints:**

- `GET /api/usage` - Check remaining quota (non-consuming)
- `POST /api/bypass` - Activate bypass code session
- `GET /api/bypass?code=XXX` - URL parameter activation

---

## Project Status

**Current Version:** v0.1.0 (User) / v1.2.21 (Dev)

**Completed (v1.0-1.4):**

- âœ… TypeScript/Vercel serverless architecture (~14,800 LOC)
- âœ… Multi-factor scoring engine with market alignment (7 dimensions)
- âœ… FMP + FRED API integration (23 calls for market context, 17 per stock)
- âœ… Market context integration (v1.3.0) - Risk-On/Risk-Off regime classification
- âœ… Delta-first analysis engine (v1.4.0) - 90-day historical tracking
- âœ… Event calendar integration (v1.2.16) - Earnings, dividends, splits, guidance
- âœ… Multi-tenant OAuth authentication with per-user database isolation
- âœ… Rate limiting system (Upstash Redis, timezone-aware)
- âœ… LLM abstraction layer (Google Gemini, OpenAI, Anthropic)
- âœ… Notion database integration (read/write optimizations, sequential deletion)
- âœ… Performance optimizations (67% token reduction, 50% faster execution)

**Current Focus (v1.5-2.0):**

- ğŸ”§ Onboarding robustness (auto-detection fixes, validation surface)
- ğŸ”§ Hallucination prevention system (validation + weekly audits)
- ğŸ”§ Market Context bug fixes (content routing, property population)
- ğŸ“‹ Production-ready Notion template with examples
- ğŸ“‹ Event-aware analysis prompts (surface upcoming events in AI context)

**Planned (v2.0+):**

- ğŸ“‹ Next.js frontend application (responsive, mobile-first)
- ğŸ“‹ PostgreSQL migration (Supabase, 10-15x faster than Notion)
- ğŸ“‹ Trend charts (Recharts, score history over time)
- ğŸ“‹ Portfolio tracking and watchlists

See [ROADMAP.md](ROADMAP.md) and [CHANGELOG.md](CHANGELOG.md) for detailed history.

---

## Cost Structure

**Monthly Operating Costs (v1.2.21):**

| Service | Cost | Usage |
| --- | --- | --- |
| Vercel Pro | $20/month | 300s timeout, unlimited invocations |
| FMP API | $22-29/month | Stock data, fundamentals, technical indicators |
| Google Gemini | $40/month | 3,000 analyses (@ $0.013 each) |
| FRED API | Free | Macroeconomic data |
| Notion | Free | Database storage (v1.2.21 only) |
| Upstash Redis | Free | Rate limiting state (under free tier limits) |
| **Total** | **$82-89/month** | For personal use (up to 3,000 analyses/month) |

**v2.0 Upgrade (PostgreSQL):**

- Add Supabase: $0-25/month (free tier â†’ Pro as needed)
- Total: $102-134/month (10-15x faster database, unlimited scale)

---

## License

**Business Source License 1.1**

### You CAN:

- âœ… Use for personal, educational, and non-commercial purposes
- âœ… View and study the source code
- âœ… Modify for your own personal use
- âœ… Fork on GitHub for non-commercial projects

### You CANNOT:

- âŒ Provide commercial stock analysis services
- âŒ Sell this software or derivative works
- âŒ Compete with the original author's offerings

### Change Date: October 23, 2029

After this date, the software becomes available under the **MIT License** (fully open source).

**Commercial licensing:** Contact [shalom.ormsby@gmail.com](mailto:shalom.ormsby@gmail.com)

See [LICENSE](LICENSE) file for full terms.

---

## Support & Contact

**Author:** Shalom Ormsby

**Email:** [shalom.ormsby@gmail.com](mailto:shalom.ormsby@gmail.com)

**Repository:** [github.com/shalomormsby/sagestocks](https://github.com/shalomormsby/sagestocks)

**For issues:**

- Check documentation in [docs/](docs/) folder first
- Review [CHANGELOG.md](CHANGELOG.md) for recent changes
- Open an issue on GitHub (when repository is public)

**For bugs:**

- Include: ticker, error message, expected vs. actual behavior
- Check [ROADMAP.md](ROADMAP.md) to see if issue is already known
- Provide Vercel function logs if possible

---

## Contributing

This is currently a personal project, but contributions are welcome for:

- Bug reports and fixes
- Documentation improvements
- Performance optimizations
- Feature suggestions (see [ROADMAP.md](ROADMAP.md) first)

**Before contributing:**

1. Read [ARCHITECTURE.md](ARCHITECTURE.md) to understand system design
2. Review [.github/FILE_ORGANIZATION.md](.github/FILE_ORGANIZATION.md) for file organization standards
3. Check [ROADMAP.md](ROADMAP.md) to avoid duplicating planned work

---

## Acknowledgments

Built with:

- Vercel - Serverless platform
- Financial Modeling Prep - Market data
- FRED - Economic data
- Google Gemini - LLM analysis generation
- Notion - Database integration (v1.4.0)
- Upstash - Redis rate limiting

---

*For legacy v0.2.x Python documentation, see [docs/legacy/README_v0.2.x.md](docs/legacy/README_v0.2.x.md)*
