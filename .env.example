# Sage Stocks v1.0 - Environment Variables
# Copy this file to .env and fill in your actual API keys
# NEVER commit the .env file to Git!

# Financial Modeling Prep API Key (get from https://site.financialmodelingprep.com/)
# Replaces Polygon + Alpha Vantage from v0.x
FMP_API_KEY=your_fmp_api_key_here

# FRED API Key (get from https://fred.stlouisfed.org/docs/api/api_key.html)
FRED_API_KEY=your_fred_api_key_here

# Notion Integration Token (create at https://www.notion.so/my-integrations)
NOTION_API_KEY=your_notion_integration_token_here

# Notion Database IDs (will be auto-created by setup wizard)
STOCK_ANALYSES_DB_ID=your_analyses_database_id_here
STOCK_HISTORY_DB_ID=your_history_database_id_here
STOCK_COMPARISONS_DB_ID=your_comparisons_database_id_here
MARKET_CONTEXT_DB_ID=your_market_context_database_id_here

# Notion User ID (for notifications - optional)
NOTION_USER_ID=your_notion_user_id_here

# Production Template ID (for user signups)
# This is the lightweight template that users duplicate during onboarding
# Get from URL: https://notion.so/Sage-Stocks-Template-<THIS_IS_THE_ID>
# Maintain with: npm run cleanup-template -- --page-id=<ID> --version=v0.1.0
# See docs/PROD_TEMPLATE.md for details
SAGE_STOCKS_TEMPLATE_ID=your_template_page_id_here

# LLM Provider Configuration
# Choose between: gemini, claude, openai
# Recommended: claude (Claude Sonnet 4.5 - most intelligent for analysis)
LLM_PROVIDER=claude
LLM_MODEL_NAME=claude-sonnet-4-5-20250929

# LLM API Keys (only one required based on LLM_PROVIDER above)
# Get API keys from:
# - Anthropic Claude: https://console.anthropic.com/ (Recommended)
# - Google Gemini: https://aistudio.google.com/apikey
# - OpenAI: https://platform.openai.com/api-keys

# Anthropic API Key (for Claude - RECOMMENDED)
# Claude Sonnet 4.5 Pricing: $3/MTok input, $15/MTok output
# Estimated cost per stock analysis: ~$0.03-0.05
# Free tier: None (requires payment method)
# Rate limits: 50 requests/min, 40K input tokens/min, 8K output tokens/min
ANTHROPIC_API_KEY=your_anthropic_api_key_here

# Google Gemini API Key (alternative option)
# Gemini 2.0 Flash Pricing: Free tier 15 RPM, Paid $0.075/MTok input, $0.30/MTok output
# Note: Free tier shares quota across all apps using same key
GEMINI_API_KEY=your_gemini_api_key_here

# OpenAI API Key (alternative option)
# GPT-4.1 Pricing: $10/MTok input, $30/MTok output
OPENAI_API_KEY=your_openai_api_key_here

# Upstash Redis (for rate limiting - get from https://upstash.com)
# Free tier: 10,000 commands/day (plenty for rate limiting)
UPSTASH_REDIS_REST_URL=your_upstash_redis_url_here
UPSTASH_REDIS_REST_TOKEN=your_upstash_redis_token_here

# Rate Limiting Configuration
RATE_LIMIT_ENABLED=true                    # Set to false to disable rate limiting in development
RATE_LIMIT_MAX_ANALYSES=10                 # Maximum analyses per user per day (default: 10)
RATE_LIMIT_BYPASS_CODE=your_bypass_code_here  # Secret code for unlimited access (20+ chars recommended)

# User Timezone (default timezone for rate limiting and timestamps)
# Use IANA timezone format (e.g., America/Los_Angeles, America/New_York, Europe/London)
# Supported: America/Adak, Pacific/Honolulu, America/Anchorage, America/Los_Angeles,
#            America/Denver, America/Chicago, America/New_York, America/Toronto,
#            America/Halifax, America/St_Johns, Europe/London, Europe/Paris, Europe/Berlin
# Default: America/Los_Angeles (frontend browser timezone takes priority if provided)
DEFAULT_TIMEZONE=America/Los_Angeles

# Optional: API Key for public endpoint authentication
# If set, all API requests must include X-API-Key header or Authorization: Bearer <key>
# If not set, endpoints are publicly accessible without authentication
API_KEY=

# Optional: Webhook signature verification
# Notion can sign webhooks for additional security
NOTION_WEBHOOK_SECRET=

# Polling Configuration (for npm run poll)
# Base URL for API calls (default: http://localhost:3000)
API_BASE_URL=http://localhost:3000
# Poll interval in seconds (default: 30)
POLL_INTERVAL=30

# ===================================================================
# Orchestrator Configuration (v1.2.0)
# ===================================================================

# Delay between ticker analyses (in milliseconds)
# Prevents API overload by spacing out requests
# Default: 8000 (8 seconds)
# Adjust based on your LLM provider's rate limits:
#   - Gemini Free: 8000-10000ms (2 RPM limit)
#   - Gemini Paid: 3000-5000ms (higher limits)
#   - Claude/OpenAI: 5000-7000ms (varies by tier)
ANALYSIS_DELAY_MS=8000

# Chunk size for chunked processing (number of stocks per chunk)
# Used to prevent Vercel timeout (800s limit) when processing many stocks
# Default: 8 stocks per chunk
# - 8 stocks: ~9 minutes per chunk (safe for 800s timeout)
# - 10 stocks: ~11 minutes per chunk (approaches limit)
# - 12+ stocks: Risk of timeout
# v1.2.0: Enables processing 15+ stocks across multiple cron invocations
CHUNK_SIZE=8

# Enable dry-run mode for testing without making actual API calls
# When enabled, orchestrator will:
#   - Collect and deduplicate stock requests
#   - Build and display priority queue
#   - Simulate analysis and broadcasting
#   - Log what WOULD happen without actual execution
#   - Calculate API calls that would be saved
# Default: false
# Set to 'true' for testing
ORCHESTRATOR_DRY_RUN=false
